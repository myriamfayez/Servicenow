<html>
    <head>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />

<style>
.fav{

    color: black;
}


.fav:hover{

    color: red;
}



.icons{

    display: flex;
    justify-content: space-between;
}


.cart:hover{
    color: red;
}
</style>
    </head>
    <body>
        
<div id="navbar"></div>


<div class="container my-5 mt-5 pt-5">


    <div class="row" id="products"></div>

    <div id="msg"></div>

</div>












        <script>


const supabaseclient=supabase.createClient('https://eyenvepjdscszapilzdi.supabase.co'// crcli fun ghza bt3ml coonnection m3 el database w da 3enwan mshro3i
    ,'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5ZW52ZXBqZHNjc3phcGlsemRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzNTMzMTEsImV4cCI6MjA4NjkyOTMxMX0.UIjUXMi3VSEX6zBOpoasYCWHslSGADmyPMkQA0bQ4F4')


async function getproducts(){


const msg=document.getElementById("msg")
const products=document.getElementById("products")



const {data,error}= await supabaseclient
.from ("products")
.select("*")



if (error){
msg.innerText=error.message
return; // w2f el function w mtkmlsh 
}


      products.innerHTML = ""; 
      // bnfdy el div mn ay haga 

data.forEach (product=>{ 
    //hylf 3ala kol row w smnah product // ` fydtha btsm7li a7ot variables gowa el html tags 

    products.innerHTML += `
<div class="col-md-4 mb-4">
        
        <div class="card h-100">
<img src="${product.image_url}" class="card-img-top" style="height:600px ;object-fit:cover;">
<div class="card-body d-flex justify-content-center align-items-center">
<h5 class="card-title">${product.title}</h5>
        </div>
        <div class="price d-flex justify-content-center align-items-center pt-0"><h6>${product.price}</h6></div>


        <div class="p-3 icons">
<i
id="heart-${product.id}"
class="fa-regular fa-heart fa-1x fav" 
onclick='clickheart(${JSON.stringify(product)},this)'></i>

<i class="fa-solid fa-1x fa-cart-arrow-down cart"
onclick='addtocart(${JSON.stringify(product)}, this)'></i>
</div>



        </div>
        </div>
        `;
        
})




}
 
getproducts()




// <button class="rounded-4">ADD TO FAVOURITES</button>












 function clickheart(product,icon){
//bt5od parameters el product el dost 3lih plus el icon bt3to 


 let favlist = JSON.parse (localStorage.getItem("favorites")) || []
    // hena 3mlna variable hygib el haga mn el local storage w yhwlo b parse 3shan bykon mtkhzen as kalam f byrg3o object or array 3shaan n3rf nt3amel m3ah


    // let isFav = favlist.some(item => item.id === product.id); // some hya built in fun btlf 3al array el id bysawi el id el ana w2fa 3lih ? lw true by8yr color lw false by8yr color

    let index = favlist.findIndex(item=> item.id=== product.id)

    // el item da variable bylf 3ala kol products fl favorites hal bt === el product id el geh m3 doset el heart?

    if (index=== -1) //lw item msh mwgod
    {
    favlist.push(product) //ht7oto. w t3'yr loon el heart
    icon.classList.remove("fa-regular") // el icon el gt m3 doset el btn w kant fl parameter
    icon.classList.add("fa-solid")
    icon.style.color="red"

}

// lw mwgood htshilo
else{
favlist.splice(index,1)

icon.classList.remove("fa-solid")
icon.classList.add ("fa-regular")
icon.style.color=""

}


// n save el hasl fl localstorage 

localStorage.setItem("favorites",JSON.stringify(favlist))
    }














    


 function addtocart(product,icon){

// hngib ay haga stored fl cat abl keda aw lw fadia

let cartlist = JSON.parse(localStorage.getItem("cart")) || []


let cartindex = cartlist.findIndex(item=>item.id=== product.id)

if (cartindex === -1)
{
    cartlist.push(product)
    icon.classList.add("text-danger")

}
else{


    cartlist.splice(cartindex,1)
    icon.classList.remove("text-danger")
}

localStorage.setItem("cart",JSON.stringify(cartlist))
 }
































// call navbar
fetch("navbar.html")
.then (res=>res.text())
.then(html=>{
    document.getElementById("navbar").innerHTML=html
})


        </script>
    </body>
</html>