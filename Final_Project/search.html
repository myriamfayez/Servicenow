<!doctype html>
<html lang="en">
  <head>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Search Page</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />


 
  </head>

  <body class="bg-light">
    <!-- Navbar -->
    <div id="navbar" style="padding-bottom: 200px;"></div>
    <!-- Search Section -->
    <section>
      <div class="container mt-5" style="min-height: 600px">
        <div class="row justify-content-center">
          <div class="col-md-8">
            <h2 class="text-center mb-4 fw-bold">Find Your Perfect Item</h2>

            <div class="card shadow-sm p-4">
              <div class="row g-2">
                <!-- Search Input -->
                <div class="col-md-6">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search by product name..."
                    id="searchInput"
                  />
                </div>

                <!-- Color Dropdown -->
                <div class="col-md-4">
                  <select class="form-select" id="colorFilter">
                    <option value="">All Colors</option>
                    <option value="Red">Red</option>
                    <option value="Black">Black</option>
                    <option value="White">White</option>
                    <option value="Blue">Blue</option>
                    <option value="Pink">Pink</option>
                  </select>
                </div>

                <!-- Button -->
                <div class="col-md-2">
                  <button class="btn btn-dark  w-100" id="searchBtn">
                    Search
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Results Section -->
        <div class="row mt-4">
          <div class="col-md-6 mx-auto">
            <div id="results" class="list-group">
              <!-- Results will appear here -->
            </div>
          </div>
        </div>
      </div>
    </section>
    <!--footer-->
    <div id="footer-container" class="mt-auto"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      fetch("navbar.html")
        .then((res) => res.text())
        .then((data) => {
          document.getElementById("navbar").innerHTML = data;
              updateLikesCounter(); 
        });

      fetch("footer.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("footer-container").innerHTML = data;
        });

      const supabaseUrl = "https://eyenvepjdscszapilzdi.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5ZW52ZXBqZHNjc3phcGlsemRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzNTMzMTEsImV4cCI6MjA4NjkyOTMxMX0.UIjUXMi3VSEX6zBOpoasYCWHslSGADmyPMkQA0bQ4F4";

      const { createClient } = supabase;
      const db = createClient(supabaseUrl, supabaseKey);

      const searchBtn = document.getElementById("searchBtn");
      const searchInput = document.getElementById("searchInput");
      const results = document.getElementById("results");
      const colorFilter = document.getElementById("colorFilter");

      document.addEventListener("DOMContentLoaded", () => {
        const searchBtn = document.getElementById("searchBtn");
        const searchInput = document.getElementById("searchInput");
        const colorFilter = document.getElementById("colorFilter");
        const results = document.getElementById("results");

        async function loadProducts() {
          const value = searchInput.value.trim();
          const selectedColor = colorFilter.value;

          results.innerHTML = `
      <div class="text-center my-3">
        <div class="spinner-border text-dark"></div>
      </div>
    `;

          let query = db.from("products").select("*");

          // Search by title
          if (value.length >= 3) {
            query = query.filter("title", "ilike", `%${value}%`);
          }

          // Filter by color (inside title)
          if (selectedColor) {
            query = query.filter("title", "ilike", `%${selectedColor}%`);
          }

          const { data, error } = await query;

          if (error) {
            results.innerHTML = `
        <div class="alert alert-danger">${error.message}</div>
      `;
            return;
          }

          if (!data || data.length === 0) {
            results.innerHTML = `
        <div class="alert alert-secondary text-center">
          No products found.
        </div>
      `;
            return;
          }

          results.innerHTML = "";

          data.forEach((product) => {
            results.innerHTML += `
        <div class="card mb-4 shadow-sm border-0">
          <img src="${product.image_url}" 
               class="card-img-top" 
               style="height:900px; object-fit:cover;">
          <div class="card-body viewproduct text-center">
            <h5 class="fw-semibold">${product.title}</h5>
            <p class="text-muted">${product.price} EGP</p>
            <a href="glam.html" class="btn  btn-outline-dark text-black btn-sm">
              View Product
            </a>
          </div>
        </div>
      `;
          });
        }

        // Search button
        searchBtn.addEventListener("click", loadProducts);

        // Auto filter when color changes
        colorFilter.addEventListener("change", loadProducts);
      });

      function updateLikesCounter() {
  let favlist = JSON.parse(localStorage.getItem("favorites")) || [];
  favlist = favlist.filter(item => item && item.id);

  const counter = document.getElementById("likes-counter");
  if (counter) {
    counter.innerText = favlist.length;
  }
}
    </script>
  </body>
</html>
